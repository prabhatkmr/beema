replicaCount: 3
image:
  repository: beema/kernel
  tag: "latest"
  pullPolicy: IfNotPresent

service:
  type: LoadBalancer
  port: 80

# Multi-Cloud Storage Configuration for Parquet
dataPlatform:
  provider: "aws" # Change to "azure" or "gcp"
  bucketName: "beema-analytics-export"
  region: "us-east-1"

# SSO / OIDC Integration
auth:
  issuerUri: "https://dev-customer.okta.com/oauth2/default"
  clientId: "beema-client-id"

global:
  marketContexts: ["RETAIL", "LONDON"]
  dataResidency:
    enabled: true
    regions:
      - name: "uk-south"
        tenants: ["london_syndicate_123"]
      - name: "us-east-1"
        tenants: ["retail_carrier_xyz"]

# ==============================================================================
# Beema Kernel Service
# ==============================================================================
beemaKernel:
  enabled: true
  replicaCount: 2

  image:
    registry: ghcr.io
    repository: beema/beema-kernel
    tag: "0.1.0-SNAPSHOT"
    pullPolicy: IfNotPresent

  service:
    type: ClusterIP
    port: 8080

  resources:
    requests:
      cpu: 250m
      memory: 512Mi
    limits:
      cpu: "1"
      memory: 1Gi

  env:
    SPRING_PROFILES_ACTIVE: "prod,json-logging"
    DB_HOST: "beema-postgresql"
    DB_PORT: "5432"
    DB_NAME: "beema_kernel"
    OAUTH2_ISSUER_URI: "https://auth.beema.local/realms/beema"

  secrets:
    dbCredentials:
      secretName: beema-db-credentials
      keys:
        DB_USERNAME: username
        DB_PASSWORD: password

  probes:
    liveness:
      httpGet:
        path: /actuator/health/liveness
        port: 8080
      initialDelaySeconds: 60
      periodSeconds: 15
      timeoutSeconds: 5
      failureThreshold: 3
    readiness:
      httpGet:
        path: /actuator/health/readiness
        port: 8080
      initialDelaySeconds: 30
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 3

  initContainers:
    flyway:
      image:
        registry: ghcr.io
        repository: beema/beema-kernel
        tag: "0.1.0-SNAPSHOT"
      command: ["java", "-cp", "app.jar", "org.flywaydb.core.Flyway", "migrate"]
      resources:
        requests:
          cpu: 100m
          memory: 256Mi
        limits:
          cpu: 500m
          memory: 512Mi

  autoscaling:
    enabled: false
    minReplicas: 2
    maxReplicas: 6
    targetCPUUtilizationPercentage: 75
    targetMemoryUtilizationPercentage: 80

# ==============================================================================
# Temporal Configuration
# ==============================================================================
temporal:
  enabled: true

  # Temporal Server Connection
  server:
    host: "temporal-frontend.temporal.svc.cluster.local"
    port: 7233
    namespace: "default"

  # Temporal Worker Configuration
  worker:
    enabled: true
    replicaCount: 2

    image:
      registry: ghcr.io
      repository: beema/beema-kernel
      tag: "0.1.0-SNAPSHOT"
      pullPolicy: IfNotPresent

    taskQueue: "BEEMA_AGREEMENT_TASK_QUEUE"

    config:
      maxConcurrentActivities: 10
      maxConcurrentWorkflows: 10
      maxConcurrentLocalActivities: 100
      workerStopTimeout: 30s

    resources:
      requests:
        cpu: 500m
        memory: 1Gi
      limits:
        cpu: "2"
        memory: 2Gi

    env:
      SPRING_PROFILES_ACTIVE: "prod,json-logging"
      DB_HOST: "beema-postgresql"
      DB_PORT: "5432"
      DB_NAME: "beema_kernel"
      TEMPORAL_WORKER_ENABLED: "true"

    secrets:
      dbCredentials:
        secretName: beema-db-credentials
        keys:
          DB_USERNAME: username
          DB_PASSWORD: password

    probes:
      liveness:
        httpGet:
          path: /actuator/health/liveness
          port: 8080
        initialDelaySeconds: 60
        periodSeconds: 20
        timeoutSeconds: 5
        failureThreshold: 3
      readiness:
        httpGet:
          path: /actuator/health/readiness
          port: 8080
        initialDelaySeconds: 45
        periodSeconds: 15
        timeoutSeconds: 5
        failureThreshold: 3

    autoscaling:
      enabled: true
      minReplicas: 2
      maxReplicas: 10
      targetCPUUtilizationPercentage: 70
      targetMemoryUtilizationPercentage: 75
      behavior:
        scaleDown:
          stabilizationWindowSeconds: 300
          policies:
            - type: Percent
              value: 50
              periodSeconds: 60
        scaleUp:
          stabilizationWindowSeconds: 60
          policies:
            - type: Percent
              value: 100
              periodSeconds: 30
